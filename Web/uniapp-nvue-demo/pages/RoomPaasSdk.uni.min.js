class e{constructor(){this.handlerList={},this.globalEvent=uni.requireNativePlugin("globalEvent")}emit(e,t){const r=this.handlerList[e];if(r)for(let e=0;e<r.length;e++)r[e](t)}on(e,t){var r;(null===(r=this.handlerList)||void 0===r?void 0:r.hasOwnProperty(e))||(this.handlerList[e]=[]);this.handlerList[e].findIndex((e=>e===t))>-1||this.handlerList[e].push(t)}remove(e,t){if(!t)return void delete this.handlerList[e];const r=this.handlerList[e].findIndex((e=>e===t));r>-1&&(this.handlerList[e].splice(r,1),0===this.handlerList[e].length&&delete this.handlerList[e])}removeAllEvents(){this.handlerList={}}errorMsg(e,t,r,n,i){const s={api:e,code:n,message:`${e}失败，${t}`,nativeMsg:i};return r&&(s.info=r),s}}var t,r,n,i,s,o,a,l;!function(e){e.ServiceEnterRoom="room.service.enterRoom",e.ServiceLeaveRoom="room.service.leaveRoom"}(t||(t={})),function(e){e.OnRequestToken="onRequestToken",e.OnKicked="onKicked"}(r||(r={})),function(e){e.EnterRoom="enterRoom",e.LeaveRoom="leaveRoom",e.KickedFromRoom="kickedFromRoom",e.PaaSRoomKickUser="kickedFromRoom"}(n||(n={})),function(e){e.CommentReceived="commentReceived",e.CommentMuted="commentMuted",e.CommentMuteCanceled="commentMuteCanceled",e.CommentAllMuted="commentAllMuted",e.CommentAllMuteCanceled="commentAllMuteCanceled",e.Liked="liked",e.CustomMessage="customMessage"}(i||(i={})),function(e){e.LiveStarted="liveStarted",e.LiveStopped="liveStopped",e.LiveFirstFrameRendered="liveFirstFrameRendered",e.LiveLoadingStarted="liveLoadingStarted",e.LiveLoadingStopped="liveLoadingStopped",e.LivePreviewStarted="livePreviewStarted",e.LivePushStarted="livePushStarted",e.LivePushStopped="livePushStopped",e.LiveNotExist="liveNotExist"}(s||(s={}));class h extends e{constructor(){super(),this.nChat=uni.requireNativePlugin("alicloud-IMPInteractionRoomUniPlugin-ChatService"),this.bindEvents()}nativeCaller(e,...t){return this.nChat?new Promise(((r,n)=>{this.nChat[e](...t,(t=>{"0"===t.code?r(t):(n(this.errorMsg(e,"Native插件错误",this.currentErrorInfo,t.code,t.msg)),this.currentErrorInfo="")}))})):Promise.reject(this.errorMsg(e,"没有获取到Native插件"))}getChatDetail(){return this.nativeCaller("getChatDetail")}sendComment(e,t){return this.nativeCaller("sendComment",{content:e,extension:t})}sendLike(){this.nativeCaller("sendLike")}listComment(e,t,r){return this.nativeCaller("listComment",{sortType:e,pageNum:t,pageSize:r})}listBanCommentUsers(){}banAllComment(){return this.nativeCaller("banAllComment")}cancelBanAllComment(){return this.nativeCaller("cancelBanAllComment")}banComment(e,t){return this.nativeCaller("banComment",{userId:e,muteSeconds:t})}cancelBanComment(e){return this.nativeCaller("cancelBanComment",{userId:e})}sendCustomMessageToUsers(e,t){return this.nativeCaller("sendCustomMessageToUsers",{body:e,userIds:t})}sendCustomMessageToAll(e){return this.nativeCaller("sendCustomMessageToAll",{body:e})}bindEvents(){Object.values(i).forEach((e=>{this.globalEvent.addEventListener(e,(t=>{this.emit(e,t)}))}))}}!function(e){e[e.VALUE_180P=0]="VALUE_180P",e[e.VALUE_240P=1]="VALUE_240P",e[e.VALUE_360P=2]="VALUE_360P",e[e.VALUE_480P=3]="VALUE_480P",e[e.VALUE_540P=4]="VALUE_540P",e[e.VALUE_720P=5]="VALUE_720P",e[e.VALUE_1080P=6]="VALUE_1080P"}(o||(o={})),function(e){e.MODE_FILL="fill",e.MODE_ASPECT_FILL="aspect_fill",e.MODE_ASPECT_FIT="aspect_fit"}(a||(a={}));class c extends e{constructor(){super(),this.instance=null}getLiveId(){return this.instance?this.instance.getLiveId():""}getLiveDetail(){return this.instance?new Promise(((e,t)=>{this.instance.getLiveDetail((r=>{"0"===r.code?e(r):(t(this.errorMsg("getLiveDetail","媒体实例错误",this.currentErrorInfo,r.code,r.msg)),this.currentErrorInfo="")}))})):Promise.reject(this.errorMsg("getLiveDetail","没有获取到媒体实例"))}}class u extends c{constructor(e){super(),this.instance=e}nativeCaller(e,...t){return this.instance?new Promise(((r,n)=>{this.instance[e](...t,(t=>{"0"===t.code?r(t):(n(this.errorMsg(e,"Player实例错误",this.currentErrorInfo,t.code,t.msg)),this.currentErrorInfo="")}))})):Promise.reject(this.errorMsg(e,"没有获取到Player实例"))}pause(){return this.instance.pause()}refresh(){return this.instance.refresh()}resume(){return this.instance.resume()}start(e){return this.instance.start({showMode:e})}stop(){return this.instance.stop()}}class m extends c{constructor(e){super(),this.instance=e}nativeCaller(e,...t){return this.instance?new Promise(((r,n)=>{this.instance[e](...t,(t=>{"0"===t.code?r(t):(n(this.errorMsg(e,"Pusher实例错误",this.currentErrorInfo,t.code,t.msg)),this.currentErrorInfo="")}))})):Promise.reject(this.errorMsg(e,"没有获取到Pusher实例"))}startLive(){return this.nativeCaller("startLive")}stopLive(){return this.nativeCaller("stopLive")}startPreview(e){return this.nativeCaller("startPreview",e)}setPreviewMode(e){return this.instance.setPreviewMode({showMode:e})}setPreviewMirror(e){return this.instance.setPreviewMirror({mirror:e})}setPushMirror(e){return this.instance.setPushMirror({mirror:e})}switchCamera(){return this.instance.switchCamera()}}!function(e){e.RTC="rtc",e.CHAT="chat",e.PLAYER="player",e.PUSHER="pusher"}(l||(l={}));class d extends e{constructor(e,t){super(),this.nick="",this.nRoomChannel=uni.requireNativePlugin("alicloud-IMPInteractionRoomUniPlugin-RoomChannel"),this.roomId=e,this.userId=t,this.nRoomChannel.setRoomId({roomId:e}),this.chatService=new h,this.playerService=null,this.pusherService=null,this.bindEvents()}get isAdmin(){return this.nRoomChannel.isAdmin()}get isOwner(){return this.nRoomChannel.isOwner()}nativeCaller(e,...t){return this.nRoomChannel?new Promise(((r,n)=>{this.nRoomChannel[e](...t,(t=>{"0"===t.code?r(t):(n(this.errorMsg(e,"Native插件错误",this.currentErrorInfo,t.code,t.msg)),this.currentErrorInfo="")}))})):Promise.reject(this.errorMsg(e,"没有获取到Native插件"))}getChatService(){return this.chatService}getPlayerService(e){return e?(this.playerService||(this.playerService=new u(e)),this.playerService):null}getPusherService(e){return e?(this.pusherService||(this.pusherService=new m(e)),this.pusherService):null}enterRoom(e){return e?(this.nick=e,this.nativeCaller("enterRoom",{nick:e})):Promise.reject(this.errorMsg("enterRoom","请传入用户昵称"))}getRoomDetail(){return this.nativeCaller("getRoomDetail")}listUser(e,t){return this.nativeCaller("getRoomDetail",{pageNum:e,pageSize:t})}kickUser(e){return this.nativeCaller("kickUser",{userId:e})}leaveRoom(){return this.nativeCaller("leaveRoom").then((e=>(this.emit(t.ServiceLeaveRoom,this.roomId),e)))}removeEvents(){this.removeAllEvents()}bindEvents(){Object.values(n).forEach((e=>{this.globalEvent.addEventListener(e,(t=>{this.emit(e,t)}))}))}}class v extends e{constructor(){super(),this.config={},this.currentErrorInfo="",this.nRoomEngine=uni.requireNativePlugin("alicloud-IMPInteractionRoomUniPlugin-RoomEngine"),this.roomChannel=null,this.bindEvents()}get isLogined(){return this.nRoomEngine.isLogined()}nativeCaller(e,...t){return this.nRoomEngine?new Promise(((r,n)=>{this.nRoomEngine[e](...t,(t=>{"0"===t.code?r(t):(n(this.errorMsg(e,"Native插件错误",this.currentErrorInfo,t.code,t.msg)),this.currentErrorInfo="")}))})):Promise.reject(this.errorMsg(e,"没有获取到Native插件"))}static getInstance(){return this.instance||(this.instance=new v),this.instance}getRoomChannel(e){if(this.config.userId&&e)return this.roomChannel||(this.roomChannel=new d(e,this.config.userId)),this.roomChannel.on(t.ServiceLeaveRoom,this.removeRoomChannel.bind(this)),this.roomChannel;console.error("未初始化或没有roomId")}removeRoomChannel(){this.roomChannel&&this.roomChannel.removeEvents&&this.roomChannel.removeEvents(),this.roomChannel=null}init(e){const t=Object.values(e);return t.length<5||t.some((e=>!e))?Promise.reject(this.errorMsg("init","参数缺失",e)):(this.config=e,this.nativeCaller("init",{appId:e.appId,appKey:e.appKey,deviceId:e.deviceId,userId:e.userId}))}login(){return this.config.userId?this.nativeCaller("login",{userId:this.config.userId}):Promise.reject(this.errorMsg("login","请先init"))}logout(){return this.config.userId?this.nativeCaller("logout",{userId:this.config.userId}):Promise.reject(this.errorMsg("logout","请先init"))}bindEvents(){this.globalEvent.addEventListener(r.OnRequestToken,(()=>{this.config.authTokenCallback&&this.config.authTokenCallback().then((e=>{this.currentErrorInfo=e,this.nRoomEngine.setLoginToken(e)})).catch((e=>{console.error(e),this.currentErrorInfo=e}))})),this.globalEvent.addEventListener(r.OnKicked,(e=>{this.emit(r.OnKicked,e)}))}}const g=Object.assign(Object.assign(Object.assign(Object.assign({},r),n),i),s);export default v;export{g as EventNameEnum,o as Resolution,a as ShowMode};
